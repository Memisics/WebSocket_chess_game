<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess-like Game</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
        }

        .game-board {
            width: 300px;
            margin: 20px auto;
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }

        .cell {
            aspect-ratio: 1;
            border: 1px solid #444;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .player-a {
            background-color: #2a2a2a;
        }

        .player-b {
            background-color: #1a1a1a;
        }

        .selected {
            background-color: #4a4a9a;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .control-btn {
            width: 30px;
            height: 30px;
            background-color: #333;
            border: none;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .control-btn:hover {
            background-color: #555;
        }
    </style>
</head>

<body>
    <div class="game-board">
        <div class="header">Current Player: A</div>
        <div id="gameGrid" class="grid">
            <!-- The grid cells will be dynamically generated by JavaScript -->
        </div>
        <div class="controls">
            <button class="control-btn" onclick="sendMove('L')">L</button>
            <button class="control-btn" onclick="sendMove('R')">R</button>
            <button class="control-btn" onclick="sendMove('F')">F</button>
            <button class="control-btn" onclick="sendMove('B')">B</button>
        </div>
    </div>

    <script>
        const websocket = new WebSocket("ws://localhost:8080");
        let currentPlayer = 'A';
        let selectedCharacter = null;

        websocket.onopen = () => {
            websocket.send(JSON.stringify({
                type: "setup",
                team: ["P1", "H1", "P2", "H2", "P3"]
            }));
        };

        websocket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === "start" || data.type === "update") {
                updateBoard(data.state.board);
                document.querySelector('.header').innerText = `Current Player: ${data.state.turn === 'player1' ? 'A' : 'B'}`;
                currentPlayer = data.state.turn === 'player1' ? 'A' : 'B';
            } else if (data.type === "error") {
                alert(data.message);
            }
        };

        function updateBoard(board) {
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = ''; // Clear previous grid

            for (let y = 0; y < board.length; y++) {
                for (let x = 0; x < board[y].length; x++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    const char = board[y][x];
                    if (char) {
                        const playerClass = char.startsWith('A') ? 'player-a' : 'player-b';
                        cell.classList.add(playerClass);
                        cell.innerText = char;
                        cell.onclick = () => selectCharacter(char);
                    }
                    grid.appendChild(cell);
                }
            }
        }

        function selectCharacter(character) {
            if (character.startsWith(currentPlayer)) {
                selectedCharacter = character;
                document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
                const cells = Array.from(document.querySelectorAll('.cell'));
                const cell = cells.find(cell => cell.innerText === character);
                if (cell) cell.classList.add('selected');
            }
        }

        function sendMove(direction) {
            if (selectedCharacter) {
                let moveCommand = `${selectedCharacter}:${direction}`;
                websocket.send(JSON.stringify({ type: "move", move: moveCommand }));
            } else {
                alert('Select a character to move.');
            }
        }
    </script>
</body>

</html>
